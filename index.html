<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSK 4 Vocabulary Quiz</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #666;
            --accent: #3498db;
            --success: #2ecc71;
            --error: #e74c3c;
            --warning: #f39c12;
            --border: #e9ecef;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-card: #333333;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --accent: #4a9eff;
            --success: #00d084;
            --error: #ff6b6b;
            --warning: #ffa726;
            --border: #444444;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: all 0.3s ease;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            min-height: 100vh;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--accent);
            color: white;
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .title {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* Quick Stats */
        .quick-stats {
            display: flex;
            justify-content: space-around;
            background: var(--bg-secondary);
            padding: 12px 8px;
            border-bottom: 1px solid var(--border);
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-number {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Progress Bar */
        .progress-container {
            background: var(--bg-secondary);
            height: 8px;
            position: relative;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 16px;
            display: flex;
            flex-direction: column;
        }

        /* Compact Controls */
        .top-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            gap: 4px;
            background: var(--bg-card);
            border-radius: 8px;
            padding: 4px;
            border: 1px solid var(--border);
        }

        .mode-btn, .batch-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: transparent;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .mode-btn.active, .batch-btn.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 2px 4px var(--shadow);
        }

        /* Question Area */
        .question-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 300px;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px var(--shadow);
            margin-bottom: 16px;
            border: 1px solid var(--border);
        }

        .question {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 24px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
        }

        .feedback {
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            border-radius: 8px;
            padding: 8px 12px;
            transition: all 0.3s ease;
        }

        .feedback.correct {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .feedback.incorrect {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
        }

        /* Options */
        .options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .option {
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 500;
            transition: all 0.2s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            color: var(--text-primary);
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .option:hover::before {
            left: 100%;
        }

        .option:active {
            transform: scale(0.98);
        }

        .option.selected {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: scale(1.02);
        }

        .option.correct {
            background: var(--success);
            color: white;
            border-color: var(--success);
            animation: pulse 0.6s ease;
        }

        .option.incorrect {
            background: var(--error);
            color: white;
            border-color: var(--error);
            animation: shake 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        /* Bottom Controls */
        .bottom-controls {
            background: var(--bg-card);
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            position: sticky;
            bottom: 0;
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            max-width: 100%;
            width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px var(--shadow);
            border: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 16px;
            text-align: center;
            color: var(--text-primary);
        }

        .modal-stats {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
        }

        .modal-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .wrong-answer {
            background: var(--bg-secondary);
            border-left: 4px solid var(--error);
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        .wrong-answer .chinese {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .wrong-answer .correct {
            color: var(--success);
            font-weight: bold;
        }

        .wrong-answer .selected {
            color: var(--error);
            text-decoration: line-through;
        }

        /* Batch Navigation */
        .batch-nav {
            background: var(--bg-secondary);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .batch-info {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .nav-buttons {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-btn.prev {
            background: var(--text-secondary);
            color: white;
        }

        .nav-btn.next {
            background: var(--accent);
            color: white;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 16px var(--shadow);
            border: 1px solid var(--border);
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        /* Hide certain elements on mobile for cleaner experience */
        @media (max-width: 768px) {
            .subtitle {
                display: none;
            }

            .question {
                font-size: 2rem;
                margin-bottom: 20px;
            }

            .option {
                font-size: 1rem;
                padding: 14px;
            }

            .modal-content {
                margin: 8px;
                padding: 20px;
            }

            .batch-nav {
                padding: 8px 12px;
            }

            .batch-info {
                font-size: 0.8rem;
            }
        }

        /* Ultra-compact mode for small screens */
        @media (max-width: 480px) {
            .header {
                padding: 8px 12px;
            }

            .title {
                font-size: 1.2rem;
            }

            .main-content {
                padding: 12px;
            }

            .question-container {
                padding: 16px;
                min-height: 250px;
            }

            .question {
                font-size: 1.8rem;
                min-height: 50px;
            }

            .options {
                gap: 8px;
            }

            .option {
                padding: 12px;
                font-size: 0.95rem;
            }

            .bottom-controls {
                padding: 8px 12px;
            }

            .action-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
        }

        /* Loading state */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--accent);
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-top">
                <h1 class="title">🎯 HSK 4 Quiz</h1>
                <button class="theme-toggle" id="theme-toggle" title="Toggle theme">
                    <span id="theme-icon">🌙</span>
                </button>
            </div>
            <p class="subtitle">Match Chinese characters to pinyin and English translations</p>
        </header>

        <!-- Quick Stats -->
        <div class="quick-stats">
            <div class="stat-item">
                <div class="stat-number" id="current-question">1</div>
                <div class="stat-label">Current</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="correct-count">0</div>
                <div class="stat-label">Correct</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="wrong-count">0</div>
                <div class="stat-label">Wrong</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="accuracy">0%</div>
                <div class="stat-label">Accuracy</div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <!-- Batch Navigation -->
        <div class="batch-nav">
            <div class="batch-info" id="batch-info">Batch 1 of 2 (50 words)</div>
            <div class="nav-buttons">
                <button class="nav-btn prev" id="prev-batch">‹</button>
                <button class="nav-btn next" id="next-batch">›</button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Compact Controls -->
            <div class="top-controls">
                <div class="control-group">
                    <button class="mode-btn active" id="mode-pinyin">📝 Pinyin</button>
                    <button class="mode-btn" id="mode-english">🇺🇸 English</button>
                </div>
                <div class="control-group">
                    <button class="batch-btn" data-size="25">25</button>
                    <button class="batch-btn active" data-size="50">50</button>
                    <button class="batch-btn" data-size="100">100</button>
                    <button class="batch-btn" data-size="all">All</button>
                </div>
            </div>

            <!-- Question Container -->
            <div class="question-container fade-in">
                <div class="question" id="question">Loading...</div>
                <div class="feedback" id="feedback"></div>
                <div class="options" id="options"></div>
            </div>
        </main>

        <!-- Bottom Controls -->
        <div class="bottom-controls">
            <button class="action-btn btn-primary" id="review-btn">📚 Review</button>
            <button class="action-btn btn-warning" id="shuffle-btn">🔀 Shuffle</button>
            <button class="action-btn btn-secondary" id="reset-btn">🔄 Reset</button>
        </div>
    </div>

    <!-- Completion Modal -->
    <div class="modal" id="completion-modal">
        <div class="modal-content">
            <h2 class="modal-title">🎉 Batch Complete!</h2>
            <div class="modal-stats" id="modal-stats"></div>
            <div id="modal-review"></div>
            <div class="modal-actions">
                <button class="action-btn btn-primary" id="continue-next">Next Batch</button>
                <button class="action-btn btn-warning" id="review-wrong-modal">Review Wrong</button>
                <button class="action-btn btn-secondary" id="restart-batch">Restart</button>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div class="modal" id="review-modal">
        <div class="modal-content">
            <h2 class="modal-title">📚 Wrong Answers Review</h2>
            <div id="review-content"></div>
            <div class="modal-actions">
                <button class="action-btn btn-primary" id="practice-wrong">Practice Wrong</button>
                <button class="action-btn btn-secondary" onclick="closeReviewModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // HSK 4 vocabulary data (same as original)
        const originalWords = [
            { chinese: "爱情", pinyin: "àiqíng", english: "Love" },
            { chinese: "安排", pinyin: "ānpái", english: "arrange" },
            { chinese: "安全", pinyin: "ānquán", english: "security" },
            { chinese: "按时", pinyin: "ànshí", english: "on time" },
            { chinese: "按照", pinyin: "ànzhào", english: "according to" },
            { chinese: "百分之", pinyin: "bǎifēnzhī", english: "percent" },
            { chinese: "棒", pinyin: "bàng", english: "stick；excellent" },
            { chinese: "包子", pinyin: "bāozi", english: "Steamed stuffed bun" },
            { chinese: "保护", pinyin: "bǎohù", english: "protect" },
            { chinese: "保证", pinyin: "bǎozhèng", english: "ensure" },
            { chinese: "抱", pinyin: "bào", english: "Hold" },
            { chinese: "抱歉", pinyin: "bàoqiàn", english: "feel sorry" },
            { chinese: "报名", pinyin: "bàomíng", english: "sign up" },
            { chinese: "倍", pinyin: "bèi", english: "times" },
            { chinese: "本来", pinyin: "běnlái", english: "originally" },
            { chinese: "笨", pinyin: "bèn", english: "stupid" },
            { chinese: "比如", pinyin: "bǐrú", english: "such as" },
            { chinese: "毕业", pinyin: "bìyè", english: "graduation" },
            { chinese: "遍", pinyin: "biàn", english: "Times" },
            { chinese: "标准", pinyin: "biāozhǔn", english: "standard" },
            { chinese: "表格", pinyin: "biǎogé", english: "form" },
            { chinese: "表示", pinyin: "biǎoshì", english: "Express" },
            { chinese: "表演", pinyin: "biǎoyǎn", english: "perform" },
            { chinese: "表扬", pinyin: "biǎoyáng", english: "Praise" },
            { chinese: "饼干", pinyin: "bǐnggān", english: "Biscuits" },
            { chinese: "并且", pinyin: "bìngqiě", english: "also" },
            { chinese: "博士", pinyin: "bóshì", english: "doctor" },
            { chinese: "不过", pinyin: "búguò", english: "However" },
            { chinese: "不得不", pinyin: "bùdébù", english: "have to" },
            { chinese: "不管", pinyin: "bùguǎn", english: "no matter" },
            { chinese: "不仅", pinyin: "bùjǐn", english: "not only" },
            { chinese: "部分", pinyin: "bùfen", english: "Part" },
            { chinese: "擦", pinyin: "cā", english: "wipe" },
            { chinese: "猜", pinyin: "cāi", english: "guess" },
            { chinese: "材料", pinyin: "cáiliào", english: "Material Science" },
            { chinese: "参观", pinyin: "cānguān", english: "visit" },
            { chinese: "餐厅", pinyin: "cāntīng", english: "Restaurant" },
            { chinese: "差不多", pinyin: "chàbuduō", english: "Almost" },
            { chinese: "尝", pinyin: "cháng", english: "taste" },
            { chinese: "长城", pinyin: "chángchéng", english: "The Great Wall" },
            { chinese: "长江", pinyin: "chángjiāng", english: "The Yangtze River" },
            { chinese: "场", pinyin: "chǎng", english: "site" },
            { chinese: "超过", pinyin: "chāoguò", english: "Exceed" },
            { chinese: "厕所", pinyin: "cèsuǒ", english: "Toilet" },
            { chinese: "成功", pinyin: "chénggōng", english: "Success" },
            { chinese: "成为", pinyin: "chéngwéi", english: "Become" },
            { chinese: "诚实", pinyin: "chéngshí", english: "honest" },
            { chinese: "乘坐", pinyin: "chéngzuò", english: "ride" },
            { chinese: "吃惊", pinyin: "chījīng", english: "Be amazed" },
            { chinese: "重新", pinyin: "chóngxīn", english: "again" },
            { chinese: "抽烟", pinyin: "chōuyān", english: "smoking" },
            { chinese: "出差", pinyin: "chūchāi", english: "A business travel" },
            { chinese: "出发", pinyin: "chūfā", english: "Set out" },
            { chinese: "出生", pinyin: "chūshēng", english: "Birth" },
            { chinese: "出现", pinyin: "chūxiàn", english: "Appear" },
            { chinese: "厨房", pinyin: "chúfáng", english: "Kitchen" },
            { chinese: "传真", pinyin: "chuánzhēn", english: "Fax" },
            { chinese: "窗户", pinyin: "chuānghu", english: "Window" },
            { chinese: "词语", pinyin: "cíyǔ", english: "terms, words" },
            { chinese: "从来", pinyin: "cónglái", english: "Always" },
            { chinese: "粗心", pinyin: "cūxīn", english: "careless" },
            { chinese: "存", pinyin: "cún", english: "Deposit" },
            { chinese: "错误", pinyin: "cuòwù", english: "error" },
            { chinese: "答案", pinyin: "dá’àn", english: "Answer" },
            { chinese: "打招呼", pinyin: "dǎzhāohu", english: "Say hello" },
            { chinese: "打扮", pinyin: "dǎban", english: "dress up" },
            { chinese: "打扰", pinyin: "dǎrǎo", english: "Disturb" },
            { chinese: "打印", pinyin: "dǎyìn", english: "Print" },
            { chinese: "打折", pinyin: "dǎzhé", english: "Discount" },
            { chinese: "打针", pinyin: "dǎzhēn", english: "To make an injection" },
            { chinese: "大概", pinyin: "dàgài", english: "Probably" },
            { chinese: "大使馆", pinyin: "dàshǐguǎn", english: "Embassy" },
            { chinese: "大约", pinyin: "dàyuē", english: "about" },
            { chinese: "戴", pinyin: "dài", english: "wear" },
            { chinese: "大夫", pinyin: "dàifu", english: "Doctor" },
            { chinese: "当", pinyin: "dāng", english: "When" },
            { chinese: "当时", pinyin: "dāngshí", english: "at that time" },
            { chinese: "刀", pinyin: "dāo", english: "knife" },
            { chinese: "导游", pinyin: "dǎoyóu", english: "Guide" },
            { chinese: "倒", pinyin: "dào", english: "inverted" },
            { chinese: "到处", pinyin: "dàochù", english: "everywhere" },
            { chinese: "到底", pinyin: "dàodǐ", english: "To the end" },
            { chinese: "道歉", pinyin: "dàoqiàn", english: "apologize" },
            { chinese: "得意", pinyin: "déyì", english: "Proud" },
            { chinese: "地点", pinyin: "dìdiǎn", english: "location" },
            { chinese: "得（助动词）", pinyin: "děi", english: "have to" },
            { chinese: "登机牌", pinyin: "dēngjīpái", english: "Boarding pass" },
            { chinese: "等 （动）", pinyin: "děng", english: "Wait (verb)" },
            { chinese: "低", pinyin: "dī", english: "low" },
            { chinese: "底", pinyin: "dǐ", english: "bottom" },
            { chinese: "地球", pinyin: "dìqiú", english: "earth" },
            { chinese: "地址", pinyin: "dìzhǐ", english: "address" },
            { chinese: "掉", pinyin: "diào", english: "fall" },
            { chinese: "调查", pinyin: "diàochá", english: "investigation" },
            { chinese: "丢", pinyin: "diū", english: "lose" },
            { chinese: "动作", pinyin: "dòngzuò", english: "action" },
            { chinese: "堵车", pinyin: "dǔchē", english: "Traffic jam" },
            { chinese: "肚子", pinyin: "dùzi", english: "belly" },
            { chinese: "短信", pinyin: "duǎnxìn", english: "Short message" },
            { chinese: "对于", pinyin: "duìyú", english: "about" },
            { chinese: "对话", pinyin: "duìhuà", english: "dialogue" },
            { chinese: "对面", pinyin: "duìmiàn", english: "Opposite side" },
            { chinese: "而", pinyin: "ér", english: "and" },
            { chinese: "儿童", pinyin: "értóng", english: "children" },
            { chinese: "发生", pinyin: "fāshēng", english: "Happen" },
            { chinese: "发展", pinyin: "fāzhǎn", english: "Development" },
            { chinese: "法律", pinyin: "fǎlǜ", english: "Law" },
            { chinese: "翻译", pinyin: "fānyì", english: "translate" },
            { chinese: "烦恼", pinyin: "fánnǎo", english: "annoyance" },
            { chinese: "反对", pinyin: "fǎnduì", english: "Opposition" },
            { chinese: "方法", pinyin: "fāngfǎ", english: "Method" },
            { chinese: "方面", pinyin: "fāngmiàn", english: "Aspect" },
            { chinese: "方向", pinyin: "fāngxiàng", english: "direction" },
            { chinese: "房东", pinyin: "fángdōng", english: "landlord" },
            { chinese: "放弃", pinyin: "fàngqì", english: "give up" },
            { chinese: "放暑假", pinyin: "fàngshǔjià", english: "summer vacation" },
            { chinese: "放松", pinyin: "fàngsōng", english: "Relax" },
            { chinese: "份", pinyin: "fèn", english: "share (measure word)" },
            { chinese: "丰富", pinyin: "fēngfù", english: "rich" },
            { chinese: "否则", pinyin: "fǒuzé", english: "otherwise" },
            { chinese: "符合", pinyin: "fúhé", english: "accord with" },
            { chinese: "富", pinyin: "fù", english: "rich" },
            { chinese: "付款", pinyin: "fùkuǎn", english: "pay" },
            { chinese: "父亲", pinyin: "fùqīn", english: "father" },
            { chinese: "复印", pinyin: "fùyìn", english: "To copy" },
            { chinese: "复杂", pinyin: "fùzá", english: "complex" },
            { chinese: "负责", pinyin: "fùzé", english: "Be responsible for" },
            { chinese: "改变", pinyin: "gǎibiàn", english: "change" },
            { chinese: "干杯", pinyin: "gānbēi", english: "Cheers!" },
            { chinese: "赶", pinyin: "gǎn", english: "catch up with" },
            { chinese: "敢", pinyin: "gǎn", english: "dare" },
            { chinese: "感动", pinyin: "gǎndòng", english: "Be moved" },
            { chinese: "感觉", pinyin: "gǎnjué", english: "feel" },
            { chinese: "感情", pinyin: "gǎnqíng", english: "feeling" },
            { chinese: "感谢", pinyin: "gǎnxiè", english: "Thank" },
            { chinese: "干", pinyin: "gān", english: "dry" },
            { chinese: "刚", pinyin: "gāng", english: "just" },
            { chinese: "高速公路", pinyin: "gāosùgōnglù", english: "Expressway" },
            { chinese: "胳膊", pinyin: "gēbo", english: "Arm" },
            { chinese: "各", pinyin: "gè", english: "various" },
            { chinese: "公里", pinyin: "gōnglǐ", english: "kilometre" },
            { chinese: "工资", pinyin: "gōngzī", english: "wages" },
            { chinese: "功夫", pinyin: "gōngfu", english: "Kungfu" },
            { chinese: "共同", pinyin: "gòngtóng", english: "common" },
            { chinese: "够", pinyin: "gòu", english: "enough" },
            { chinese: "购物", pinyin: "gòuwù", english: "Shopping" },
            { chinese: "估计", pinyin: "gūjì", english: "estimate" },
            { chinese: "鼓励", pinyin: "gǔlì", english: "encourage" },
            { chinese: "顾客", pinyin: "gùkè", english: "customer" },
            { chinese: "故意", pinyin: "gùyì", english: "deliberately" },
            { chinese: "挂", pinyin: "guà", english: "hang" },
            { chinese: "关键", pinyin: "guānjiàn", english: "key" },
            { chinese: "观众", pinyin: "guānzhòng", english: "Audience" },
            { chinese: "管理", pinyin: "guǎnlǐ", english: "Administration" },
            { chinese: "光", pinyin: "guāng", english: "light" },
            { chinese: "广播", pinyin: "guǎngbō", english: "Radio broadcast" },
            { chinese: "广告", pinyin: "guǎnggào", english: "Advertisement" },
            { chinese: "逛", pinyin: "guàng", english: "Stroll" },
            { chinese: "规定", pinyin: "guīdìng", english: "Regulations" },
            { chinese: "国际", pinyin: "guójì", english: "international" },
            { chinese: "国籍", pinyin: "guójí", english: "nationality" },
            { chinese: "果汁", pinyin: "guǒzhī", english: "fruit juice" },
            { chinese: "过程", pinyin: "guòchéng", english: "process" },
            { chinese: "海洋", pinyin: "hǎiyáng", english: "ocean" },
            { chinese: "害羞", pinyin: "hàixiū", english: "Shy" },
            { chinese: "寒假", pinyin: "hánjià", english: "The winter vacation" },
            { chinese: "汗", pinyin: "hàn", english: "sweat" },
            { chinese: "航班", pinyin: "hángbān", english: "flight" },
            { chinese: "好处", pinyin: "hǎochù", english: "benefit" },
            { chinese: "好像", pinyin: "hǎoxiàng", english: "Be like, seem" },
            { chinese: "号码", pinyin: "hàomǎ", english: "number" },
            { chinese: "合格", pinyin: "hégé", english: "qualified" },
            { chinese: "合适", pinyin: "héshì", english: "appropriate" },
            { chinese: "盒子", pinyin: "hézi", english: "Box" },
            { chinese: "厚", pinyin: "hòu", english: "thick" },
            { chinese: "后悔", pinyin: "hòuhuǐ", english: "regret" },
            { chinese: "护士", pinyin: "hùshi", english: "Nurse" },
            { chinese: "互联网", pinyin: "hùliánwǎng", english: "Internet" },
            { chinese: "互相", pinyin: "hùxiāng", english: "each other" },
            { chinese: "怀疑", pinyin: "huáiyí", english: "doubt" },
            { chinese: "回忆", pinyin: "huíyì", english: "Memory" },
            { chinese: "活动", pinyin: "huódòng", english: "activity" },
            { chinese: "活泼", pinyin: "huópō", english: "lively" },
            { chinese: "火", pinyin: "huǒ", english: "fire" },
            { chinese: "获得", pinyin: "huòdé", english: "Get" },
            { chinese: "基础", pinyin: "jīchǔ", english: "Basics" },
            { chinese: "激动", pinyin: "jīdòng", english: "Excited" },
            { chinese: "积极", pinyin: "jījí", english: "positive" },
            { chinese: "积累", pinyin: "jīlěi", english: "accumulation" },
            { chinese: "及时", pinyin: "jíshí", english: "timely" },
            { chinese: "即使", pinyin: "jíshǐ", english: "even if" },
            { chinese: "寄", pinyin: "jì", english: "send" },
            { chinese: "记者", pinyin: "jìzhě", english: "Reporter" },
            { chinese: "计划", pinyin: "jìhuà", english: "plan" },
            { chinese: "既然", pinyin: "jìrán", english: "although" },
            { chinese: "技术", pinyin: "jìshù", english: "technology" },
            { chinese: "继续", pinyin: "jìxù", english: "Continue" },
            { chinese: "家具", pinyin: "jiājù", english: "furniture" },
            { chinese: "加班", pinyin: "jiābān", english: "overtime work" },
            { chinese: "加油站", pinyin: "jiāyóuzhàn", english: "Gas station" },
            { chinese: "假", pinyin: "jiǎ", english: "false" },
            { chinese: "价格", pinyin: "jiàgé", english: "Price" },
            { chinese: "坚持", pinyin: "jiānchí", english: "Insist" },
            { chinese: "减肥", pinyin: "jiǎnféi", english: "Reduce weight" },
            { chinese: "减少", pinyin: "jiǎnshǎo", english: "reduce" },
            { chinese: "建议", pinyin: "jiànyì", english: "proposal" },
            { chinese: "将来", pinyin: "jiānglái", english: "future" },
            { chinese: "奖金", pinyin: "jiǎngjīn", english: "bonus" },
            { chinese: "降低", pinyin: "jiàngdī", english: "reduce" },
            { chinese: "降落", pinyin: "jiàngluò", english: "land" },
            { chinese: "交", pinyin: "jiāo", english: "hand over" },
            { chinese: "交流", pinyin: "jiāoliú", english: "Communication" },
            { chinese: "交通", pinyin: "jiāotōng", english: "traffic" },
            { chinese: "郊区", pinyin: "jiāoqū", english: "Suburb" },
            { chinese: "骄傲", pinyin: "jiāo’ào", english: "Proud" },
            { chinese: "饺子", pinyin: "jiǎozi", english: "Dumplings" },
            { chinese: "教授", pinyin: "jiàoshòu", english: "professor" },
            { chinese: "教育", pinyin: "jiàoyù", english: "education" },
            { chinese: "接受", pinyin: "jiēshòu", english: "accept" },
            { chinese: "接着", pinyin: "jiēzhe", english: "Next" },
            { chinese: "结果", pinyin: "jiéguǒ", english: "Result" },
            { chinese: "节", pinyin: "jié", english: "section, festival" },
            { chinese: "节约", pinyin: "jiéyuē", english: "save" },
            { chinese: "解释", pinyin: "jiěshì", english: "explain" },
            { chinese: "尽管", pinyin: "jǐnguǎn", english: "although" },
            { chinese: "紧张", pinyin: "jǐnzhāng", english: "Nervous" },
            { chinese: "进行", pinyin: "jìnxíng", english: "in process of" },
            { chinese: "禁止", pinyin: "jìnzhǐ", english: "prohibit" },
            { chinese: "精彩", pinyin: "jīngcǎi", english: "Marvellous" },
            { chinese: "经济", pinyin: "jīngjì", english: "Economics" },
            { chinese: "经历", pinyin: "jīnglì", english: "experience" },
            { chinese: "经验", pinyin: "jīngyàn", english: "experience" },
            { chinese: "京剧", pinyin: "jīngjù", english: "Beijing opera" },
            { chinese: "警察", pinyin: "jǐngchá", english: "Policeman" },
            { chinese: "景色", pinyin: "jǐngsè", english: "scenery" },
            { chinese: "竟然", pinyin: "jìngrán", english: "Unexpectedly" },
            { chinese: "竞争", pinyin: "jìngzhēng", english: "compete" },
            { chinese: "镜子", pinyin: "jìngzi", english: "Mirror" },
            { chinese: "究竟", pinyin: "jiūjìng", english: "exactly" },
            { chinese: "举", pinyin: "jǔ", english: "lift" },
            { chinese: "举办", pinyin: "jǔbàn", english: "hold" },
            { chinese: "举行", pinyin: "jǔxíng", english: "hold" },
            { chinese: "拒绝", pinyin: "jùjué", english: "refuse" },
            { chinese: "距离", pinyin: "jùlí", english: "distance" },
            { chinese: "聚会", pinyin: "jùhuì", english: "Party" },
            { chinese: "开玩笑", pinyin: "kāiwánxiào", english: "Make fun of" },
            { chinese: "开心", pinyin: "kāixīn", english: "Happy" },
            { chinese: "看法", pinyin: "kànfǎ", english: "view" },
            { chinese: "考虑", pinyin: "kǎolǜ", english: "Consider" },
            { chinese: "烤鸭", pinyin: "kǎoyā", english: "Roasted Duck" },
            { chinese: "棵", pinyin: "kē", english: "Tree (measure word)" },
            { chinese: "科学", pinyin: "kēxué", english: "science" },
            { chinese: "咳嗽", pinyin: "késou", english: "cough" },
            { chinese: "可怜", pinyin: "kělián", english: "Poor" },
            { chinese: "可是", pinyin: "kěshì", english: "however" },
            { chinese: "可惜", pinyin: "kěxī", english: "unfortunately" },
            { chinese: "客厅", pinyin: "kètīng", english: "A living room" },
            { chinese: "肯定", pinyin: "kěndìng", english: "sure" },
            { chinese: "空", pinyin: "kōng", english: "empty" },
            { chinese: "空气", pinyin: "kōngqì", english: "air" },
            { chinese: "恐怕", pinyin: "kǒngpà", english: "I’m afraid" },
            { chinese: "苦", pinyin: "kǔ", english: "bitter" },
            { chinese: "矿泉水", pinyin: "kuàngquánshuǐ", english: "Mineral water" },
            { chinese: "困", pinyin: "kùn", english: "sleepy" },
            { chinese: "困难", pinyin: "kùnnan", english: "difficulty" },
            { chinese: "拉", pinyin: "lā", english: "pull" },
            { chinese: "垃圾桶", pinyin: "lājītǒng", english: "Trash" },
            { chinese: "辣", pinyin: "là", english: "spicy" },
            { chinese: "来自", pinyin: "láizì", english: "Come from" },
            { chinese: "来不及", pinyin: "láibují", english: "There’s not enough time" },
            { chinese: "来得及", pinyin: "láidejí", english: "In time" },
            { chinese: "懒", pinyin: "lǎn", english: "lazy" },
            { chinese: "浪费", pinyin: "làngfèi", english: "Waste" },
            { chinese: "浪漫", pinyin: "làngmàn", english: "romantic" },
            { chinese: "老虎", pinyin: "lǎohǔ", english: "Tiger" },
            { chinese: "冷静", pinyin: "lěngjìng", english: "calm down" },
            { chinese: "理发", pinyin: "lǐfà", english: "Haircut" },
            { chinese: "理解", pinyin: "lǐjiě", english: "Understand" },
            { chinese: "理想", pinyin: "lǐxiǎng", english: "ideal" },
            { chinese: "礼貌", pinyin: "lǐmào", english: "politeness" },
            { chinese: "礼拜天", pinyin: "lǐbàitiān", english: "Sunday" },
            { chinese: "厉害", pinyin: "lìhai", english: "Fierce" },
            { chinese: "力气", pinyin: "lìqi", english: "Strength" },
            { chinese: "例如", pinyin: "lìrú", english: "for example" },
            { chinese: "俩", pinyin: "liǎ", english: "Two" },
            { chinese: "连", pinyin: "lián", english: "even" },
            { chinese: "联系", pinyin: "liánxì", english: "contact" },
            { chinese: "凉快", pinyin: "liángkuai", english: "Pleasantly cool" },
            { chinese: "零钱", pinyin: "língqián", english: "Small change" },
            { chinese: "另外", pinyin: "lìngwài", english: "in addition" },
            { chinese: "留", pinyin: "liú", english: "stay" },
            { chinese: "流利", pinyin: "liúlì", english: "fluent" },
            { chinese: "流行", pinyin: "liúxíng", english: "Popular" },
            { chinese: "乱", pinyin: "luàn", english: "chaos" },
            { chinese: "旅行", pinyin: "lǚxíng", english: "travel" },
            { chinese: "律师", pinyin: "lǜshī", english: "Lawyer" },
            { chinese: "麻烦", pinyin: "máfan", english: "trouble" },
            { chinese: "马虎", pinyin: "mǎhu", english: "Careless" },
            { chinese: "满", pinyin: "mǎn", english: "full" },
            { chinese: "毛", pinyin: "máo", english: "hair" },
            { chinese: "毛巾", pinyin: "máojīn", english: "Towel" },
            { chinese: "美丽", pinyin: "měilì", english: "beautiful" },
            { chinese: "梦", pinyin: "mèng", english: "dream" },
            { chinese: "迷路", pinyin: "mílù", english: "Get lost" },
            { chinese: "密码", pinyin: "mìmǎ", english: "Password" },
            { chinese: "免费", pinyin: "miǎnfèi", english: "Free of charge" },
            { chinese: "秒", pinyin: "miǎo", english: "second" },
            { chinese: "民族", pinyin: "mínzú", english: "Nation" },
            { chinese: "母亲", pinyin: "mǔqīn", english: "mother" },
            { chinese: "目的", pinyin: "mùdì", english: "objective" },
            { chinese: "耐心", pinyin: "nàixīn", english: "patience" },
            { chinese: "难道", pinyin: "nándào", english: "could it be said that …" },
            { chinese: "难受", pinyin: "nánshòu", english: "Uncomfortable" },
            { chinese: "内", pinyin: "nèi", english: "within" },
            { chinese: "内容", pinyin: "nèiróng", english: "content" },
            { chinese: "能力", pinyin: "nénglì", english: "ability" },
            { chinese: "年龄", pinyin: "niánlíng", english: "Age" },
            { chinese: "弄", pinyin: "nòng", english: "get, make" },
            { chinese: "暖和", pinyin: "nuǎnhuo", english: "warm" },
            { chinese: "偶尔", pinyin: "ǒu’ěr", english: "occasionally" },
            { chinese: "排队", pinyin: "páiduì", english: "queue; stand in a line" },
            { chinese: "排列", pinyin: "páiliè", english: "array" },
            { chinese: "判断", pinyin: "pànduàn", english: "judge" },
            { chinese: "陪", pinyin: "péi", english: "accompany" },
            { chinese: "批评", pinyin: "pīpíng", english: "criticism" },
            { chinese: "皮肤", pinyin: "pífū", english: "skin" },
            { chinese: "脾气", pinyin: "píqi", english: "Bad temper" },
            { chinese: "篇", pinyin: "piān", english: "piece" },
            { chinese: "骗", pinyin: "piàn", english: "fool" },
            { chinese: "乒乓球", pinyin: "pīngpāngqiú", english: "Table Tennis" },
            { chinese: "平时", pinyin: "píngshí", english: "peacetime" },
            { chinese: "破", pinyin: "pò", english: "broken" },
            { chinese: "葡萄", pinyin: "pútao", english: "Grape" },
            { chinese: "普遍", pinyin: "pǔbiàn", english: "universal" },
            { chinese: "普通话", pinyin: "pǔtōnghuà", english: "Mandarin" },
            { chinese: "其次", pinyin: "qícì", english: "Secondly" },
            { chinese: "其中", pinyin: "qízhōng", english: "among" },
            { chinese: "气候", pinyin: "qìhòu", english: "climate" },
            { chinese: "千万", pinyin: "qiānwàn", english: "Must" },
            { chinese: "签证", pinyin: "qiānzhèng", english: "visa" },
            { chinese: "敲", pinyin: "qiāo", english: "knock" },
            { chinese: "桥", pinyin: "qiáo", english: "Bridge" },
            { chinese: "巧克力", pinyin: "qiǎokèlì", english: "Chocolates" },
            { chinese: "亲戚", pinyin: "qīnqi", english: "Relative" },
            { chinese: "轻", pinyin: "qīng", english: "light" },
            { chinese: "轻松", pinyin: "qīngsōng", english: "Relaxed" },
            { chinese: "情况", pinyin: "qíngkuàng", english: "Situation" },
            { chinese: "穷", pinyin: "qióng", english: "poor" },
            { chinese: "区别", pinyin: "qūbié", english: "Difference" },
            { chinese: "取", pinyin: "qǔ", english: "take" },
            { chinese: "全部", pinyin: "quánbù", english: "whole" },
            { chinese: "缺点", pinyin: "quēdiǎn", english: "shortcoming" },
            { chinese: "缺少", pinyin: "quēshǎo", english: "Lack" },
            { chinese: "却", pinyin: "què", english: "but" },
            { chinese: "确实", pinyin: "quèshí", english: "Exactly" },
            { chinese: "然而", pinyin: "rán’ér", english: "however" },
            { chinese: "热闹", pinyin: "rènao", english: "lively" },
            { chinese: "任何", pinyin: "rènhé", english: "whatever, any" },
            { chinese: "任务", pinyin: "rènwu", english: "task" },
            { chinese: "扔", pinyin: "rēng", english: "throw" },
            { chinese: "仍然", pinyin: "réngrán", english: "still" },
            { chinese: "日记", pinyin: "rìjì", english: "diary" },
            { chinese: "入口", pinyin: "rùkǒu", english: "Entrance" },
            { chinese: "散步", pinyin: "sànbù", english: "Take a walk" },
            { chinese: "森林", pinyin: "sēnlín", english: "Forest" },
            { chinese: "沙发", pinyin: "shāfā", english: "Sofa" },
            { chinese: "商量", pinyin: "shāngliang", english: "discuss" },
            { chinese: "伤心", pinyin: "shāngxīn", english: "Sad" },
            { chinese: "稍微", pinyin: "shāowēi", english: "slightly" },
            { chinese: "勺子", pinyin: "sháozi", english: "Spoon" },
            { chinese: "社会", pinyin: "shèhuì", english: "Sociology" },
            { chinese: "深", pinyin: "shēn", english: "deep" },
            { chinese: "申请", pinyin: "shēnqǐng", english: "Apply" },
            { chinese: "甚至", pinyin: "shènzhì", english: "Even to the extent that" },
            { chinese: "生活", pinyin: "shēnghuó", english: "Life" },
            { chinese: "生命", pinyin: "shēngmìng", english: "life" },
            { chinese: "生意", pinyin: "shēngyi", english: "business" },
            { chinese: "省", pinyin: "shěng", english: "province" },
            { chinese: "剩", pinyin: "shèng", english: "Left" },
            { chinese: "失败", pinyin: "shībài", english: "fail" },
            { chinese: "失望", pinyin: "shīwàng", english: "Disappointment" },
            { chinese: "师傅", pinyin: "shīfu", english: "Master worker" },
            { chinese: "十分", pinyin: "shífēn", english: "very" },
            { chinese: "实际", pinyin: "shíjì", english: "Actual" },
            { chinese: "实在", pinyin: "shízài", english: "really" },
            { chinese: "使", pinyin: "shǐ", english: "make" },
            { chinese: "使用", pinyin: "shǐyòng", english: "Use" },
            { chinese: "是否", pinyin: "shìfǒu", english: "Whether" },
            { chinese: "适合", pinyin: "shìhé", english: "Fit" },
            { chinese: "适应", pinyin: "shìyìng", english: "Adapt" },
            { chinese: "世纪", pinyin: "shìjì", english: "century" },
            { chinese: "收", pinyin: "shōu", english: "collect" },
            { chinese: "收入", pinyin: "shōurù", english: "income" },
            { chinese: "收拾", pinyin: "shōushi", english: "Tidy" },
            { chinese: "首都", pinyin: "shǒudū", english: "capital" },
            { chinese: "首先", pinyin: "shǒuxiān", english: "First" },
            { chinese: "受不了", pinyin: "shòubuliǎo", english: "Cannot bear sth" },
            { chinese: "受到", pinyin: "shòudào", english: "Suffer" },
            { chinese: "售货员", pinyin: "shòuhuòyuán", english: "Salesperson" },
            { chinese: "输", pinyin: "shū", english: "lose, fail" },
            { chinese: "熟悉", pinyin: "shúxī", english: "be familiar with" },
            { chinese: "数量", pinyin: "shùliàng", english: "Number" },
            { chinese: "数字", pinyin: "shùzì", english: "number" },
            { chinese: "帅", pinyin: "shuài", english: "Handsome" },
            { chinese: "顺便", pinyin: "shùnbiàn", english: "Incidentally" },
            { chinese: "顺利", pinyin: "shùnlì", english: "smoothly" },
            { chinese: "顺序", pinyin: "shùnxù", english: "order" },
            { chinese: "说明", pinyin: "shuōmíng", english: "Explain" },
            { chinese: "硕士", pinyin: "shuòshì", english: "master" },
            { chinese: "死", pinyin: "sǐ", english: "die" },
            { chinese: "速度", pinyin: "sùdù", english: "speed" },
            { chinese: "塑料袋", pinyin: "sùliàodài", english: "Plastic bag" },
            { chinese: "酸", pinyin: "suān", english: "acid" },
            { chinese: "随便", pinyin: "suíbiàn", english: "casual" },
            { chinese: "随着", pinyin: "suízhe", english: "along with" },
            { chinese: "孙子", pinyin: "sūnzi", english: "Grandson" },
            { chinese: "所有", pinyin: "suǒyǒu", english: "All" },
            { chinese: "台", pinyin: "tái", english: "platform" },
            { chinese: "抬", pinyin: "tái", english: "Lift" },
            { chinese: "态度", pinyin: "tàidu", english: "attitude" },
            { chinese: "谈", pinyin: "tán", english: "talk" },
            { chinese: "弹钢琴", pinyin: "tángāngqín", english: "Play the piano" },
            { chinese: "汤", pinyin: "tāng", english: "soup" },
            { chinese: "糖", pinyin: "táng", english: "sugar" },
            { chinese: "躺", pinyin: "tǎng", english: "lie" },
            { chinese: "趟", pinyin: "tàng", english: "Trip" },
            { chinese: "讨论", pinyin: "tǎolùn", english: "discuss" },
            { chinese: "讨厌", pinyin: "tǎoyàn", english: "Hate" },
            { chinese: "特点", pinyin: "tèdiǎn", english: "Characteristic" },
            { chinese: "提", pinyin: "tí", english: "carry" },
            { chinese: "提供", pinyin: "tígōng", english: "provide" },
            { chinese: "提前", pinyin: "tíqián", english: "in advance" },
            { chinese: "提醒", pinyin: "tíxǐng", english: "remind" },
            { chinese: "填空", pinyin: "tiánkòng", english: "Fill in the blanks" },
            { chinese: "条件", pinyin: "tiáojiàn", english: "condition" },
            { chinese: "停", pinyin: "tíng", english: "Stop" },
            { chinese: "挺", pinyin: "tǐng", english: "quite" },
            { chinese: "通过", pinyin: "tōngguò", english: "through" },
            { chinese: "通知", pinyin: "tōngzhī", english: "notice" },
            { chinese: "同时", pinyin: "tóngshí", english: "meanwhile" },
            { chinese: "同情", pinyin: "tóngqíng", english: "Sympathy" },
            { chinese: "推", pinyin: "tuī", english: "push" },
            { chinese: "推迟", pinyin: "tuīchí", english: "delay" },
            { chinese: "脱", pinyin: "tuō", english: "take off" },
            { chinese: "袜子", pinyin: "wàzi", english: "Socks" },
            { chinese: "完全", pinyin: "wánquán", english: "completely" },
            { chinese: "往往", pinyin: "wǎngwǎng", english: "Often" },
            { chinese: "网球", pinyin: "wǎngqiú", english: "Tennis" },
            { chinese: "网站", pinyin: "wǎngzhàn", english: "website" },
            { chinese: "危险", pinyin: "wēixiǎn", english: "danger" },
            { chinese: "味道", pinyin: "wèidào", english: "taste" },
            { chinese: "卫生间", pinyin: "wèishēngjiān", english: "toilet" },
            { chinese: "温度", pinyin: "wēndù", english: "temperature" },
            { chinese: "文章", pinyin: "wénzhāng", english: "Article" },
            { chinese: "污染", pinyin: "wūrǎn", english: "contaminated" },
            { chinese: "无", pinyin: "wú", english: "nothing" },
            { chinese: "无聊", pinyin: "wúliáo", english: "Boring" },
            { chinese: "无论", pinyin: "wúlùn", english: "no matter what" },
            { chinese: "误会", pinyin: "wùhuì", english: "Misunderstanding" },
            { chinese: "西红柿", pinyin: "xīhóngshì", english: "Tomato" },
            { chinese: "吸引", pinyin: "xīyǐn", english: "Attract" },
            { chinese: "咸", pinyin: "xián", english: "salty" },
            { chinese: "现金", pinyin: "xiànjīn", english: "cash" },
            { chinese: "羡慕", pinyin: "xiànmù", english: "Envy" },
            { chinese: "香", pinyin: "xiāng", english: "fragrant" },
            { chinese: "相反", pinyin: "xiāngfǎn", english: "Contrary" },
            { chinese: "相同", pinyin: "xiāngtóng", english: "identical" },
            { chinese: "详细", pinyin: "xiángxì", english: "detailed" },
            { chinese: "响", pinyin: "xiǎng", english: "ring" },
            { chinese: "橡皮", pinyin: "xiàngpí", english: "rubber" },
            { chinese: "消息", pinyin: "xiāoxi", english: "message" },
            { chinese: "小吃", pinyin: "xiǎochī", english: "snack" },
            { chinese: "小伙子", pinyin: "xiǎohuǒzi", english: "Young fellow" },
            { chinese: "小说", pinyin: "xiǎoshuō", english: "Novel" },
            { chinese: "笑话", pinyin: "xiàohua", english: "joke" },
            { chinese: "效果", pinyin: "xiàoguǒ", english: "Effect" },
            { chinese: "辛苦", pinyin: "xīnkǔ", english: "hard" },
            { chinese: "心情", pinyin: "xīnqíng", english: "mood" },
            { chinese: "信封", pinyin: "xìnfēng", english: "envelope" },
            { chinese: "信息", pinyin: "xìnxī", english: "information" },
            { chinese: "信心", pinyin: "xìnxīn", english: "confidence" },
            { chinese: "兴奋", pinyin: "xīngfèn", english: "Excitement" },
            { chinese: "行", pinyin: "xíng", english: "That’s ok" },
            { chinese: "醒", pinyin: "xǐng", english: "wake up" },
            { chinese: "性别", pinyin: "xìngbié", english: "Gender" },
            { chinese: "性格", pinyin: "xìnggé", english: "character" },
            { chinese: "幸福", pinyin: "xìngfú", english: "happiness" },
            { chinese: "修理", pinyin: "xiūlǐ", english: "repair" },
            { chinese: "许多", pinyin: "xǔduō", english: "many" },
            { chinese: "学期", pinyin: "xuéqī", english: "Semester" },
            { chinese: "压力", pinyin: "yālì", english: "pressure" },
            { chinese: "牙膏", pinyin: "yágāo", english: "toothpaste" },
            { chinese: "亚洲", pinyin: "yàzhōu", english: "Asia" },
            { chinese: "呀", pinyin: "ya", english: "ah" },
            { chinese: "盐", pinyin: "yán", english: "salt" },
            { chinese: "严格", pinyin: "yángé", english: "strict" },
            { chinese: "严重", pinyin: "yánzhòng", english: "serious" },
            { chinese: "研究", pinyin: "yánjiū", english: "research" },
            { chinese: "演出", pinyin: "yǎnchū", english: "show" },
            { chinese: "演员", pinyin: "yǎnyuán", english: "performer, actor" },
            { chinese: "眼镜", pinyin: "yǎnjìng", english: "glasses" },
            { chinese: "阳光", pinyin: "yángguāng", english: "Sunshine" },
            { chinese: "养成", pinyin: "yǎngchéng", english: "Cultivate" },
            { chinese: "样子", pinyin: "yàngzi", english: "A look" },
            { chinese: "邀请", pinyin: "yāoqǐng", english: "Invitation" },
            { chinese: "要是", pinyin: "yàoshi", english: "If" },
            { chinese: "钥匙", pinyin: "yàoshi", english: "Key" },
            { chinese: "也许", pinyin: "yěxǔ", english: "perhaps" },
            { chinese: "页", pinyin: "yè", english: "page" },
            { chinese: "叶子", pinyin: "yèzi", english: "Leaf" },
            { chinese: "一切", pinyin: "yíqiè", english: "everything" },
            { chinese: "以", pinyin: "yǐ", english: "with" },
            { chinese: "以为", pinyin: "yǐwéi", english: "Think" },
            { chinese: "意见", pinyin: "yìjiàn", english: "Opinion" },
            { chinese: "艺术", pinyin: "yìshù", english: "Art" },
            { chinese: "因此", pinyin: "yīncǐ", english: "therefore" },
            { chinese: "引起", pinyin: "yǐnqǐ", english: "cause" },
            { chinese: "印象", pinyin: "yìnxiàng", english: "impression" },
            { chinese: "应聘", pinyin: "yìngpìn", english: "Apply for" },
            { chinese: "赢", pinyin: "yíng", english: "win" },
            { chinese: "勇敢", pinyin: "yǒnggǎn", english: "Brave" },
            { chinese: "永远", pinyin: "yǒngyuǎn", english: "forever" },
            { chinese: "优点", pinyin: "yōudiǎn", english: "Advantage" },
            { chinese: "优秀", pinyin: "yōuxiù", english: "excellent" },
            { chinese: "幽默", pinyin: "yōumò", english: "Humor" },
            { chinese: "由", pinyin: "yóu", english: "from" },
            { chinese: "由于", pinyin: "yóuyú", english: "Because" },
            { chinese: "邮局", pinyin: "yóujú", english: "Post Office" },
            { chinese: "尤其", pinyin: "yóuqí", english: "especially" },
            { chinese: "有趣", pinyin: "yǒuqù", english: "interesting" },
            { chinese: "友好", pinyin: "yǒuhǎo", english: "friendly" },
            { chinese: "友谊", pinyin: "yǒuyì", english: "friendship" },
            { chinese: "愉快", pinyin: "yúkuài", english: "Cheerful" },
            { chinese: "于是", pinyin: "yúshì", english: "Therefore" },
            { chinese: "与", pinyin: "yǔ", english: "and" },
            { chinese: "语法", pinyin: "yǔfǎ", english: "grammar" },
            { chinese: "语言", pinyin: "yǔyán", english: "language" },
            { chinese: "羽毛球", pinyin: "yǔmáoqiú", english: "Badminton" },
            { chinese: "预习", pinyin: "yùxí", english: "Preview" },
            { chinese: "原来", pinyin: "yuánlái", english: "Original" },
            { chinese: "原谅", pinyin: "yuánliàng", english: "Forgive" },
            { chinese: "原因", pinyin: "yuányīn", english: "Reason" },
            { chinese: "约会", pinyin: "yuēhuì", english: "Date" },
            { chinese: "阅读", pinyin: "yuèdú", english: "Read" },
            { chinese: "云", pinyin: "yún", english: "cloud" },
            { chinese: "允许", pinyin: "yǔnxǔ", english: "allow" },
            { chinese: "杂志", pinyin: "zázhì", english: "Magazine" },
            { chinese: "咱们", pinyin: "zánmen", english: "We" },
            { chinese: "暂时", pinyin: "zànshí", english: "temporary" },
            { chinese: "脏", pinyin: "zāng", english: "dirty" },
            { chinese: "责任", pinyin: "zérèn", english: "responsibility" },
            { chinese: "增加", pinyin: "zēngjiā", english: "increase" },
            { chinese: "占线", pinyin: "zhànxiàn", english: "(line) Busy" },
            { chinese: "招聘", pinyin: "zhāopìn", english: "recruit" },
            { chinese: "照", pinyin: "zhào", english: "reflect" },
            { chinese: "真正", pinyin: "zhēnzhèng", english: "real" },
            { chinese: "整理", pinyin: "zhěnglǐ", english: "Arrangement" },
            { chinese: "正常", pinyin: "zhèngcháng", english: "normal" },
            { chinese: "正好", pinyin: "zhènghǎo", english: "Just right" },
            { chinese: "正确", pinyin: "zhèngquè", english: "Correct" },
            { chinese: "正式", pinyin: "zhèngshì", english: "formal" },
            { chinese: "证明", pinyin: "zhèngmíng", english: "Prove" },
            { chinese: "之", pinyin: "zhī", english: "of" },
            { chinese: "支持", pinyin: "zhīchí", english: "Support" },
            { chinese: "知识", pinyin: "zhīshi", english: "knowledge" },
            { chinese: "值得", pinyin: "zhídé", english: "Worth" },
            { chinese: "直接", pinyin: "zhíjiē", english: "direct" },
            { chinese: "植物", pinyin: "zhíwù", english: "Botany, plant" },
            { chinese: "职业", pinyin: "zhíyè", english: "Occupation" },
            { chinese: "指", pinyin: "zhǐ", english: "finger, to point" },
            { chinese: "只好", pinyin: "zhǐhǎo", english: "have to" },
            { chinese: "只要", pinyin: "zhǐyào", english: "as long as" },
            { chinese: "质量", pinyin: "zhìliàng", english: "quality" },
            { chinese: "至少", pinyin: "zhìshǎo", english: "at least" },
            { chinese: "重", pinyin: "zhòng", english: "heavy" },
            { chinese: "重点", pinyin: "zhòngdiǎn", english: "A key" },
            { chinese: "重视", pinyin: "zhòngshì", english: "importance, attach importance to" },
            { chinese: "周围", pinyin: "zhōuwéi", english: "around" },
            { chinese: "主意", pinyin: "zhǔyi", english: "idea" },
            { chinese: "祝贺", pinyin: "zhùhè", english: "Congratulate" },
            { chinese: "著名", pinyin: "zhùmíng", english: "famous" },
            { chinese: "专门", pinyin: "zhuānmén", english: "specialized" },
            { chinese: "专业", pinyin: "zhuānyè", english: "major" },
            { chinese: "转", pinyin: "zhuàn", english: "turn" },
            { chinese: "赚", pinyin: "zhuàn", english: "earn" },
            { chinese: "准确", pinyin: "zhǔnquè", english: "accuracy" },
            { chinese: "准时", pinyin: "zhǔnshí", english: "on time" },
            { chinese: "仔细", pinyin: "zǐxì", english: "careful" },
            { chinese: "自然", pinyin: "zìrán", english: "natural" },
            { chinese: "自信", pinyin: "zìxìn", english: "self-confidence" },
            { chinese: "总结", pinyin: "zǒngjié", english: "summary" },
            { chinese: "租", pinyin: "zū", english: "rent" },
            { chinese: "最好", pinyin: "zuìhǎo", english: "Best" },
            { chinese: "尊重", pinyin: "zūnzhòng", english: "respect" },
            { chinese: "左右", pinyin: "zuǒyòu", english: "About" },
            { chinese: "座", pinyin: "zuò", english: "Seat" },
            { chinese: "作家", pinyin: "zuòjiā", english: "writer" },
            { chinese: "座位", pinyin: "zuòwèi", english: "seat" },
            { chinese: "作用", pinyin: "zuòyòng", english: "Effect" },
            { chinese: "作者", pinyin: "zuòzhě", english: "author" }

        ];

        // Quiz state variables (same as original)
        let currentBatch = 0;
        let batchSize = 50;
        let currentBatchWords = [];
        let currentIndex = 0;
        let correctAnswers = 0;
        let wrongAnswers = [];
        let totalAnswered = 0;
        let isPinyinMode = true;
        let selectedOption = null;
        let isReviewMode = false;
        let reviewWords = [];

        // DOM elements
        const questionEl = document.getElementById('question');
        const optionsEl = document.getElementById('options');
        const currentQuestionEl = document.getElementById('current-question');
        const correctCountEl = document.getElementById('correct-count');
        const wrongCountEl = document.getElementById('wrong-count');
        const accuracyEl = document.getElementById('accuracy');
        const progressBar = document.getElementById('progress-bar');
        const feedbackEl = document.getElementById('feedback');
        const batchInfoEl = document.getElementById('batch-info');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');

        // Theme management
        function initTheme() {
            const savedTheme = localStorage.getItem('hsk4-theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('hsk4-theme', newTheme);
            updateThemeIcon(newTheme);
            showToast(`Switched to ${newTheme} theme`);
        }

        function updateThemeIcon(theme) {
            themeIcon.textContent = theme === 'light' ? '🌙' : '☀️';
        }

        // Toast notifications
        function showToast(message, duration = 3000) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // Initialize
        function init() {
            initTheme();
            loadProgress();
            setupEventListeners();
            updateBatchInfo();
            loadCurrentBatch();
            generateQuestion();
            updateUI();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            // Batch size buttons
            document.querySelectorAll('.batch-btn').forEach(btn => {
                btn.addEventListener('click', () => changeBatchSize(btn.dataset.size));
            });

            // Mode buttons
            document.getElementById('mode-pinyin').addEventListener('click', () => switchMode(true));
            document.getElementById('mode-english').addEventListener('click', () => switchMode(false));

            // Navigation buttons
            document.getElementById('prev-batch').addEventListener('click', () => changeBatch(-1));
            document.getElementById('next-batch').addEventListener('click', () => changeBatch(1));

            // Control buttons
            document.getElementById('review-btn').addEventListener('click', showReviewModal);
            document.getElementById('shuffle-btn').addEventListener('click', shuffleCurrentBatch);
            document.getElementById('reset-btn').addEventListener('click', resetProgress);

            // Modal buttons
            document.getElementById('continue-next').addEventListener('click', continueToNextBatch);
            document.getElementById('review-wrong-modal').addEventListener('click', showReviewModal);
            document.getElementById('restart-batch').addEventListener('click', restartCurrentBatch);
            document.getElementById('practice-wrong').addEventListener('click', startReviewPractice);

            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });

            // Touch and keyboard controls
            document.addEventListener('keydown', handleKeydown);

            // Add touch feedback for better mobile experience
            document.addEventListener('touchstart', function() {}, { passive: true });
        }

        // Keyboard controls
        function handleKeydown(e) {
            if (e.key >= '1' && e.key <= '4') {
                const optionIndex = parseInt(e.key) - 1;
                const options = document.querySelectorAll('.option');
                if (options[optionIndex] && !selectedOption) {
                    selectOption.call(options[optionIndex]);
                }
            } else if (e.key === ' ' || e.key === 'Enter') {
                e.preventDefault();
                if (selectedOption) {
                    checkAnswer();
                }
            }
        }

        // All other functions remain the same as the original, with minor UI updates for mobile optimization

        // Change batch size
        function changeBatchSize(size) {
            document.querySelectorAll('.batch-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.size === size);
            });

            batchSize = size === 'all' ? originalWords.length : parseInt(size);
            currentBatch = 0;
            resetCurrentBatch();
            updateBatchInfo();
            loadCurrentBatch();
            generateQuestion();
            updateUI();
            saveProgress();
            showToast(`Switched to ${size} words per batch`);
        }

        // Change batch
        function changeBatch(direction) {
            const totalBatches = Math.ceil(originalWords.length / batchSize);
            const newBatch = currentBatch + direction;

            if (newBatch >= 0 && newBatch < totalBatches) {
                currentBatch = newBatch;
                resetCurrentBatch();
                loadCurrentBatch();
                generateQuestion();
                updateUI();
                saveProgress();
            }
        }

        // Load current batch words
        function loadCurrentBatch() {
            const startIdx = currentBatch * batchSize;
            const endIdx = Math.min(startIdx + batchSize, originalWords.length);
            currentBatchWords = originalWords.slice(startIdx, endIdx);

            if (!isReviewMode) {
                shuffleArray(currentBatchWords);
            }
        }

        // Update batch information
        function updateBatchInfo() {
            const totalBatches = Math.ceil(originalWords.length / batchSize);
            const startWord = currentBatch * batchSize + 1;
            const endWord = Math.min((currentBatch + 1) * batchSize, originalWords.length);

            batchInfoEl.textContent = `Batch ${currentBatch + 1} of ${totalBatches} (${currentBatchWords.length} words)`;

            // Update navigation buttons
            document.getElementById('prev-batch').disabled = currentBatch === 0;
            document.getElementById('next-batch').disabled = currentBatch === totalBatches - 1;
        }

        // Switch between pinyin and english mode
        function switchMode(pinyinMode) {
            isPinyinMode = pinyinMode;
            document.getElementById('mode-pinyin').classList.toggle('active', pinyinMode);
            document.getElementById('mode-english').classList.toggle('active', !pinyinMode);
            generateQuestion();
        }

        // Generate question and options
        function generateQuestion() {
            const wordsToUse = isReviewMode ? reviewWords : currentBatchWords;

            if (currentIndex >= wordsToUse.length) {
                if (isReviewMode) {
                    showReviewCompleteModal();
                } else {
                    showCompletionModal();
                }
                return;
            }

            const currentWord = wordsToUse[currentIndex];
            questionEl.textContent = currentWord.chinese;
            feedbackEl.textContent = '';
            feedbackEl.className = 'feedback';

            // Reset options
            optionsEl.innerHTML = '';

            // Create correct option
            const correctOption = document.createElement('div');
            correctOption.className = 'option';
            correctOption.dataset.correct = 'true';
            correctOption.textContent = isPinyinMode
                ? `${currentWord.pinyin} - ${currentWord.english}`
                : currentWord.english;

            // Create smart similar incorrect options
            const incorrectOptions = generateSimilarOptions(currentWord, wordsToUse);

            // Combine and shuffle options
            const allOptions = [correctOption, ...incorrectOptions];
            shuffleArray(allOptions);

            // Add options to DOM with touch-friendly spacing
            allOptions.forEach((option, index) => {
                option.addEventListener('click', selectOption);
                option.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    selectOption.call(this);
                });
                option.title = `Option ${index + 1}`;
                optionsEl.appendChild(option);
            });

            selectedOption = null;
            updateBatchInfo();

            // Add fade-in animation
            questionEl.parentElement.classList.add('fade-in');
            setTimeout(() => {
                questionEl.parentElement.classList.remove('fade-in');
            }, 300);
        }

        // Generate similar options (simplified for mobile performance)
        function generateSimilarOptions(correctWord, sourceWords) {
            const incorrectOptions = [];
            const allWords = isReviewMode ? originalWords : sourceWords;

            // Calculate similarity scores for all words
            const similarWords = allWords
                .filter(word => word.chinese !== correctWord.chinese)
                .map(word => ({
                    word: word,
                    score: calculateSimilarityScore(correctWord, word)
                }))
                .sort((a, b) => b.score - a.score);

            // Strategy: Use most similar words, with some randomness for variety
            const candidates = [];

            // Get top 20% most similar words
            const topSimilar = similarWords.slice(0, Math.max(10, Math.floor(similarWords.length * 0.2)));

            // Add some medium similar words for variety
            const mediumSimilar = similarWords.slice(
                Math.floor(similarWords.length * 0.2),
                Math.floor(similarWords.length * 0.5)
            );

            // Combine with weighted preference for more similar words
            candidates.push(...topSimilar, ...topSimilar, ...mediumSimilar);

            // Select 3 unique options
            const usedWords = new Set([correctWord.chinese]);
            let attempts = 0;

            while (incorrectOptions.length < 3 && attempts < 50) {
                const randomCandidate = candidates[Math.floor(Math.random() * candidates.length)];

                if (randomCandidate && !usedWords.has(randomCandidate.word.chinese)) {
                    usedWords.add(randomCandidate.word.chinese);

                    const option = document.createElement('div');
                    option.className = 'option';
                    option.dataset.similarity = randomCandidate.score.toFixed(2);
                    option.textContent = isPinyinMode
                        ? `${randomCandidate.word.pinyin} - ${randomCandidate.word.english}`
                        : randomCandidate.word.english;

                    incorrectOptions.push(option);
                }
                attempts++;
            }

            // If we couldn't find enough similar options, fill with random ones
            while (incorrectOptions.length < 3) {
                const randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                if (!usedWords.has(randomWord.chinese)) {
                    usedWords.add(randomWord.chinese);

                    const option = document.createElement('div');
                    option.className = 'option';
                    option.textContent = isPinyinMode
                        ? `${randomWord.pinyin} - ${randomWord.english}`
                        : randomWord.english;

                    incorrectOptions.push(option);
                }
            }

            return incorrectOptions;
        }

        // Calculate similarity score between two words (optimized)
        function calculateSimilarityScore(word1, word2) {
            let score = 0;

            if (isPinyinMode) {
                // Pinyin similarity analysis
                score += calculatePinyinSimilarity(word1.pinyin, word2.pinyin) * 50;
                score += calculateToneSimilarity(word1.pinyin, word2.pinyin) * 30;
                score += calculateEnglishSimilarity(word1.english, word2.english) * 20;
            } else {
                // English similarity analysis
                score += calculateEnglishSimilarity(word1.english, word2.english) * 60;
                score += calculatePinyinSimilarity(word1.pinyin, word2.pinyin) * 25;
                score += calculateChineseSimilarity(word1.chinese, word2.chinese) * 15;
            }

            return score;
        }

        // Calculate pinyin similarity (sound similarity) - simplified
        function calculatePinyinSimilarity(pinyin1, pinyin2) {
            if (!pinyin1 || !pinyin2) return 0;

            // Simple comparison for mobile performance
            const clean1 = pinyin1.toLowerCase().replace(/[1-5àáâãäāăąèéêëēĕėęìíîïīĭįòóôõöōŏőùúûüūŭůűų]/g, '');
            const clean2 = pinyin2.toLowerCase().replace(/[1-5àáâãäāăąèéêëēĕėęìíîïīĭįòóôõöōŏőùúûüūŭůűų]/g, '');

            if (clean1 === clean2) return 1.0;

            let similarity = 0;
            if (clean1[0] === clean2[0]) similarity += 0.4;

            const final1 = clean1.slice(1);
            const final2 = clean2.slice(1);
            if (final1 === final2) similarity += 0.6;
            else if (final1.includes(final2) || final2.includes(final1)) similarity += 0.3;

            return Math.min(similarity, 1.0);
        }

        // Calculate tone similarity - simplified
        function calculateToneSimilarity(pinyin1, pinyin2) {
            const getTone = (pinyin) => {
                if (!pinyin) return 0;
                if (/[āēīōūǖ]/.test(pinyin)) return 1;
                if (/[áéíóúǘ]/.test(pinyin)) return 2;
                if (/[ǎěǐǒǔǚ]/.test(pinyin)) return 3;
                if (/[àèìòùǜ]/.test(pinyin)) return 4;
                if (/[1-4]/.test(pinyin)) return parseInt(pinyin.match(/[1-4]/)[0]);
                return 0;
            };

            const tone1 = getTone(pinyin1);
            const tone2 = getTone(pinyin2);

            if (tone1 === tone2) return 1.0;
            if (Math.abs(tone1 - tone2) === 1) return 0.5;
            return 0;
        }

        // Calculate English meaning similarity - simplified
        function calculateEnglishSimilarity(english1, english2) {
            if (!english1 || !english2) return 0;

            const clean1 = english1.toLowerCase().trim();
            const clean2 = english2.toLowerCase().trim();

            if (clean1 === clean2) return 1.0;

            const words1 = clean1.split(/\s+|[,;]/);
            const words2 = clean2.split(/\s+|[,;]/);

            let commonWords = 0;
            let totalWords = Math.max(words1.length, words2.length);

            words1.forEach(word1 => {
                if (words2.some(word2 => word1 === word2 || word1.includes(word2) || word2.includes(word1))) {
                    commonWords++;
                }
            });

            return commonWords / totalWords;
        }

        // Calculate Chinese character similarity - simplified
        function calculateChineseSimilarity(chinese1, chinese2) {
            if (!chinese1 || !chinese2) return 0;

            let similarity = 0;
            const chars1 = chinese1.split('');
            const chars2 = chinese2.split('');

            chars1.forEach(char1 => {
                if (chars2.includes(char1)) {
                    similarity += 0.5;
                }
            });

            return similarity / Math.max(chars1.length, chars2.length);
        }

        // Select an option with haptic feedback
        function selectOption() {
            if (selectedOption) return;

            // Haptic feedback for mobile
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }

            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));

            this.classList.add('selected');
            selectedOption = this;

            setTimeout(() => {
                checkAnswer();
            }, 300);
        }

        // Check answer with enhanced feedback
        function checkAnswer() {
            if (!selectedOption) {
                feedbackEl.textContent = 'Please select an answer first!';
                feedbackEl.className = 'feedback incorrect';
                return;
            }

            const options = document.querySelectorAll('.option');
            options.forEach(opt => {
                opt.removeEventListener('click', selectOption);
                opt.style.pointerEvents = 'none';
                if (opt.dataset.correct === 'true') {
                    opt.classList.add('correct');
                }
                if (opt === selectedOption && opt.dataset.correct !== 'true') {
                    opt.classList.add('incorrect');
                }
            });

            const wordsToUse = isReviewMode ? reviewWords : currentBatchWords;
            const currentWord = wordsToUse[currentIndex];

            totalAnswered++;

            if (selectedOption.dataset.correct === 'true') {
                feedbackEl.innerHTML = '🎉 Correct! Well done!';
                feedbackEl.className = 'feedback correct';
                correctAnswers++;

                // Success haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([50, 50, 100]);
                }
            } else {
                const correctText = isPinyinMode
                    ? `${currentWord.pinyin} - ${currentWord.english}`
                    : currentWord.english;

                feedbackEl.innerHTML = `❌ Incorrect.<br><strong>${correctText}</strong>`;
                feedbackEl.className = 'feedback incorrect';

                // Error haptic feedback
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100, 50, 100]);
                }

                // Add to wrong answers
                const wrongAnswer = {
                    word: currentWord,
                    selectedAnswer: selectedOption.textContent,
                    correctAnswer: correctText,
                    mode: isPinyinMode ? 'pinyin' : 'english'
                };
                wrongAnswers.push(wrongAnswer);
            }

            updateUI();
            saveProgress();

            setTimeout(() => {
                nextQuestion();
            }, 2000); // Shorter delay for mobile
        }

        // Next question
        function nextQuestion() {
            currentIndex++;
            generateQuestion();
            updateUI();
        }

        // Update UI elements
        function updateUI() {
            const wordsToUse = isReviewMode ? reviewWords : currentBatchWords;
            currentQuestionEl.textContent = currentIndex + 1;
            correctCountEl.textContent = correctAnswers;
            wrongCountEl.textContent = wrongAnswers.length;

            const accuracy = totalAnswered > 0 ? Math.round((correctAnswers / totalAnswered) * 100) : 0;
            accuracyEl.textContent = `${accuracy}%`;

            const progress = Math.min(((currentIndex) / wordsToUse.length) * 100, 100);
            progressBar.style.width = `${progress}%`;
        }

        // Show completion modal with mobile-optimized content
        function showCompletionModal() {
            const accuracy = Math.round((correctAnswers / totalAnswered) * 100);
            const grade = accuracy >= 90 ? 'Excellent!' :
                         accuracy >= 80 ? 'Great job!' :
                         accuracy >= 70 ? 'Good work!' :
                         accuracy >= 60 ? 'Keep practicing!' : 'Need more study';

            const modalStats = document.getElementById('modal-stats');
            modalStats.innerHTML = `
                <div style="text-align: center; font-size: 1.1rem; line-height: 1.6;">
                    <p><strong>🎯 Batch ${currentBatch + 1} Complete!</strong></p>
                    <p>✅ Correct: ${correctAnswers} | ❌ Wrong: ${wrongAnswers.length}</p>
                    <p>📊 Accuracy: <strong>${accuracy}%</strong></p>
                    <p>🏆 Grade: <strong style="color: var(--accent);">${grade}</strong></p>
                </div>
            `;

            // Show/hide continue button based on available batches
            const totalBatches = Math.ceil(originalWords.length / batchSize);
            const continueBtn = document.getElementById('continue-next');
            continueBtn.style.display = currentBatch < totalBatches - 1 ? 'inline-flex' : 'none';

            document.getElementById('completion-modal').style.display = 'flex';
        }

        // Show review modal with compact mobile layout
        function showReviewModal() {
            if (wrongAnswers.length === 0) {
                showToast('No wrong answers to review yet! 🎉');
                return;
            }

            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = `
                <div style="margin-bottom: 16px; text-align: center;">
                    <p><strong>📋 Review ${wrongAnswers.length} wrong answers</strong></p>
                </div>
                <div style="max-height: 300px; overflow-y: auto;">
                    ${wrongAnswers.slice(0, 10).map((wa, index) => `
                        <div class="wrong-answer">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <div class="chinese">${wa.word.chinese}</div>
                                <small style="opacity: 0.7;">#${index + 1}</small>
                            </div>
                            <div style="font-size: 0.9rem; margin-bottom: 4px;"><strong>📌 ${wa.word.pinyin}</strong> - ${wa.word.english}</div>
                            <div style="font-size: 0.85rem;">
                                <div>❌ <span class="selected">${wa.selectedAnswer}</span></div>
                                <div>✅ <span class="correct">${wa.mode === 'pinyin' ? `${wa.word.pinyin} - ${wa.word.english}` : wa.word.english}</span></div>
                            </div>
                        </div>
                    `).join('')}
                    ${wrongAnswers.length > 10 ? `<p style="text-align: center; margin-top: 12px;"><em>...and ${wrongAnswers.length - 10} more</em></p>` : ''}
                </div>
            `;

            document.getElementById('review-modal').style.display = 'flex';
        }

        // Start review practice
        function startReviewPractice() {
            if (wrongAnswers.length === 0) return;

            isReviewMode = true;
            reviewWords = wrongAnswers.map(wa => wa.word);
            shuffleArray(reviewWords);

            currentIndex = 0;
            correctAnswers = 0;
            totalAnswered = 0;
            wrongAnswers = [];

            document.getElementById('review-modal').style.display = 'none';
            document.getElementById('completion-modal').style.display = 'none';

            generateQuestion();
            updateUI();
            showToast(`Starting review practice with ${reviewWords.length} words`);
        }

        // Show review complete modal
        function showReviewCompleteModal() {
            const accuracy = Math.round((correctAnswers / totalAnswered) * 100);
            showToast(`Review Complete! ${correctAnswers}/${reviewWords.length} correct (${accuracy}%)`);
            setTimeout(() => exitReviewMode(), 1000);
        }

        // Exit review mode
        function exitReviewMode() {
            isReviewMode = false;
            reviewWords = [];
            generateQuestion();
            updateUI();
        }

        // Continue to next batch
        function continueToNextBatch() {
            document.getElementById('completion-modal').style.display = 'none';
            changeBatch(1);
        }

        // Restart current batch
        function restartCurrentBatch() {
            document.getElementById('completion-modal').style.display = 'none';
            resetCurrentBatch();
            generateQuestion();
            updateUI();
        }

        // Reset current batch
        function resetCurrentBatch() {
            currentIndex = 0;
            correctAnswers = 0;
            wrongAnswers = [];
            totalAnswered = 0;
        }

        // Shuffle current batch
        function shuffleCurrentBatch() {
            if (isReviewMode) {
                shuffleArray(reviewWords);
            } else {
                shuffleArray(currentBatchWords);
            }
            currentIndex = 0;
            generateQuestion();
            updateUI();
            showToast('Batch shuffled! 🔀');
        }

        // Reset all progress
        function resetProgress() {
            if (confirm('Reset all progress? This will start over from the beginning.')) {
                currentBatch = 0;
                resetCurrentBatch();
                isReviewMode = false;
                reviewWords = [];
                clearProgress();
                loadCurrentBatch();
                updateBatchInfo();
                generateQuestion();
                updateUI();
                showToast('Progress reset! Starting fresh 🔄');
            }
        }

        // Close review modal
        function closeReviewModal() {
            document.getElementById('review-modal').style.display = 'none';
        }

        // Save progress to localStorage
        function saveProgress() {
            try {
                localStorage.setItem('hsk4QuizProgress', JSON.stringify({
                    currentBatch,
                    batchSize,
                    currentIndex,
                    correctAnswers,
                    wrongAnswers,
                    totalAnswered,
                    isPinyinMode,
                    isReviewMode,
                    reviewWords,
                    lastSaved: new Date().getTime()
                }));
            } catch (e) {
                console.warn('Could not save progress:', e);
            }
        }

        // Load progress from localStorage
        function loadProgress() {
            try {
                const saved = localStorage.getItem('hsk4QuizProgress');
                if (saved) {
                    const savedData = JSON.parse(saved);

                    currentBatch = savedData.currentBatch || 0;
                    batchSize = savedData.batchSize || 50;
                    currentIndex = savedData.currentIndex || 0;
                    correctAnswers = savedData.correctAnswers || 0;
                    wrongAnswers = savedData.wrongAnswers || [];
                    totalAnswered = savedData.totalAnswered || 0;
                    isPinyinMode = savedData.isPinyinMode !== undefined ? savedData.isPinyinMode : true;
                    isReviewMode = savedData.isReviewMode || false;
                    reviewWords = savedData.reviewWords || [];

                    // Update UI elements
                    document.querySelectorAll('.batch-btn').forEach(btn => {
                        btn.classList.toggle('active',
                            (btn.dataset.size === 'all' && batchSize === originalWords.length) ||
                            parseInt(btn.dataset.size) === batchSize
                        );
                    });

                    document.getElementById('mode-pinyin').classList.toggle('active', isPinyinMode);
                    document.getElementById('mode-english').classList.toggle('active', !isPinyinMode);

                    if (savedData.lastSaved) {
                        showToast('Progress restored! 📱');
                    }
                }
            } catch (e) {
                console.warn('Could not load progress:', e);
            }
        }

        // Clear progress from storage
        function clearProgress() {
            try {
                localStorage.removeItem('hsk4QuizProgress');
            } catch (e) {
                console.warn('Could not clear progress:', e);
            }
        }

        // Shuffle array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize the app
        init();
    </script>
</body>
</html>